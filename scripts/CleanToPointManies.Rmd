---
title: "Manies Clean to Point"
author: "Anna Talucci"
date: '2022-12-11'
output: html_document
---


# clear environment
```{r}
rm(list=ls())
```

# Overview

Adapt script form M. Loranty data_cleaning, to only clean and not aggregate data. 

Use data from csv files in Google Drive

What this script does:


# Packages

```{r}
library(tidyverse)
library(lubridate)
library(sf)
```
# Projection

WGS 84 need for gee
```{r}
wgs_proj =  "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs "
```

# Data

# vector of data files
```{r}
f <- list.files(path = "../data/GoogleDriveCsvFolder/",
                pattern = "*.csv", full.names = TRUE)
```

```{r}
f
```



## Manies
```{r}
f9 <- read.csv(f[9], header = TRUE)
f9
```
```{r}
str(f9)
```

# Fixes 
```{r}
f9 = f9 %>%
   mutate(thaw_active=replace(thaw_active, thaw_active==TRUE, 'thaw')) %>% # switch true to thaw
     as.data.frame() %>%
  mutate(slope=replace(slope, slope==FALSE, 'flat')) %>% # switch false to flat
     as.data.frame() %>%
  mutate(organic_depth = (na.strings = "unk")) %>%
     as.data.frame() 
```

```{r}
f9_dates = f9 %>%
  mutate(date = as.Date(with(., paste(year, month, day,sep="-")), "%Y-%m-%d")) %>%
  mutate(julianDate = yday(date)) %>%
  dplyr::select(-notes)

f9_dates
```


```{r}
f9_dates %>% distinct(site_id, plot_id, fire_id, burn_unburn) %>% write.csv(., '../outputs/pairs/manies.csv')
```



```{r}
f9_dates %>% distinct(site_id, thaw_active, julianDate, year, date)
```
Apr 1  to September 30 (91-273)
```{r eval=FALSE, include=FALSE}
ggplot(f9_dates, aes(x=lat, y=long, color=thaw_active)) +
  geom_jitter()
```

# Finish cleaning to match other datasets
```{r}
( 
  f9_clean = f9_dates %>%  
  mutate(across(c(plot_id, site_id, fire_id), as.character)) %>% 
  mutate(across(c(fire_year, organic_depth, slope, day), as.numeric)) %>% 
    mutate(across(day, ~coalesce(., 0))) %>%
  rename(lastNm = last_name, cntryId = country_code, lon=long, biome=boreal_tundra, vegCC = veg_cover_class, siteId = site_id, plotId = plot_id, fireId = fire_id, fireYr = fire_year, distur = burn_unburn, orgDpth = organic_depth, msrDepth = thaw_depth, hitRock=hit_rock, gtProbe = gt_probe, msrType = thaw_active, topoPos = topo_position, jDate = julianDate) %>%
    mutate(msrType = as.character(msrType))
)
```

# Create points shapefile

## For f9
sf::st_as_sf(dd, coords = c("x","y"))
```{r}
f9_pts = st_as_sf(f9_clean, coords = c("lon","lat"), crs = 4326, remove = FALSE)
```


### write to shapefile
```{r}
st_write(f9_pts, "../outputs/allPoints/Manies_pts.shp", driver="ESRI Shapefile")
```