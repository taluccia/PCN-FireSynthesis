---
title: " O'Donnell Clean to Point"
author: "Anna Talucci"
date: '2022-12-11'
output: html_document
---


# clear environment
```{r}
rm(list=ls())
```

# Overview

Adapt script form M. Loranty data_cleaning, to only clean and not aggregate data. 

Use data from csv files in Google Drive

What this script does:


# Packages

```{r}
library(tidyverse)
library(lubridate)
library(sf)
```
# Projection

WGS 84 need for gee
```{r}
wgs_proj =  "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs "
```

# Data

# vector of data files
```{r}
f <- list.files(path = "../data/GoogleDriveCsvFolder/",
                pattern = "*.csv", full.names = TRUE)
```

```{r}
f
```



## O'Donnell
```{r}
f10 <- read.csv(f[10], header = TRUE)
f10
```
```{r}
str(f10)
```
# fix incorrect logical columns
```{r}
f10$organic_depth <- as.numeric(gsub(">", "",f10$organic_depth))

f10$thaw_depth <- as.numeric(gsub(">", "",f10$thaw_depth))

f10 %>% distinct(site_id,year,month,day,fire_id,burn_unburn)

```

```{r}
f10_dates = f10 %>%
  mutate(date = as.Date(with(., paste(year, month, day,sep="-")), "%Y-%m-%d")) %>%
  mutate(julianDate = yday(date))

f10_dates
```

```{r}
f10 %>% distinct(site_id, plot_id, fire_id, burn_unburn) %>% write.csv(., '../outputs/pairs/odonnell.csv')
```

```{r}
f10_dates %>% distinct(julianDate, year, date)
```
```{r}
f10_dates %>% distinct(site_id, thaw_active, julianDate, year, date)
```

```{r}
ggplot(f10_dates, aes(x=lat, y=long, color=thaw_active)) +
  geom_point()
```


# Split by active & thaw
```{r}
f10_thaw = f10_dates %>% 
  filter(thaw_active == "T") 

f10_thaw

f10_active = f10_dates %>% 
  filter(thaw_active == "A") 

f10_active
```
```{r}
unique(f10_active$date)
```
```{r}
unique(f10_active$julianDate)
```

```{r}
unique(f10_thaw$date)
```

# Save clean data
```{r}
write_csv(f10_active, "../outputs/CleanActive/ODonnellCleanActive.csv")
```



# Create points shapefile

## For F10
sf::st_as_sf(dd, coords = c("x","y"))
```{r}
f10_thaw_pts = st_as_sf(f10_thaw, coords = c("long","lat"), crs = 4326, remove = FALSE)
f10_active_pts = st_as_sf(f10_active, coords = c("long","lat"), crs = 4326, remove = FALSE)
f10_pts = st_as_sf(f10_dates, coords = c("long","lat"), crs = 4326, remove = FALSE)
```


### write to shapefile
```{r}
st_write(f10_active_pts, "../outputs/ActivePoints/ODonnell_thaw_pts.shp", driver="ESRI Shapefile")
st_write(f10_thaw_pts, "../outputs/ThawPoints/ODonnell_thaw_pts.shp", driver="ESRI Shapefile")
st_write(f10_pts, "../outputs/allPoints/ODonnell_pts.shp", driver="ESRI Shapefile")
```
